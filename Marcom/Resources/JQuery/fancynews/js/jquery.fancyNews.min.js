(function (e) { function t(e, t) { var n = e.split(" "), r = ""; if (n.length > t) { for (var i = 0; i < t; ++i) r += n[i] + " "; return r + "<span style='font-size: 12px;color: #97B250;'> read more</span>" } else return e } function n(e, t, n) { return String(e + "-" + n + " of " + n + " News") } jQuery.fn.fancyNews = function (n) { function r() { var n = []; e.jGFeed(c.feed, function (e) { if (!e) { h.find("#fn-preloader").remove(); h.append("<span id='fc-error'>No feeds found! Please check your RSS feed!</span>"); return false } for (var r = 0; r < e.entries.length; r++) { var s = e.entries[r]; m[r] = s.title; g[r] = String(s.publishedDate).substr(0, 16); y[r] = t(s.contentSnippet.slice(0, s.contentSnippet.length - 3), c.maxWords); b[r] = s.content; w[r] = s.link; n[r] = "<div class='fn-newsPreview' style='width:" + c.width + "px; height:" + p + "px; background:" + c.backgroundColor + ";'><span class='fn-newsPreviewText' ><h3>" + m[r] + "</h3><h4>" + g[r] + "</h4>" + y[r] + "</span></div>" } i(n) }, c.numOfEntries) } function i(t) { h.find("#fn-preloader").remove(); for (var n = 0; n < t.length; ++n) h.append(t[n]).find(".fn-newsPreview:last").css({ top: n * (p + c.previewOffset) }); E = e.makeArray(h.find(".fn-newsPreview")); h.append("<div id='fn-newsView' style='width:100%;height:" + h.height() + "px;'><h3 id='fn-newsViewTitle'></h3><div id='fn-newsViewHtml' style='width:" + (c.width - 30) + "px;height:" + (h.height() - 50) + "px;'></div></div>"); h.find("#fn-newsViewHtml").jScrollPane(); t = h.find("#fn-newsViewHtml"); t.jScrollPane(); d = t.data("jsp"); h.after("<div id='fn-newsFooterBar' style='width:" + c.width + "px;background:" + c.backgroundColor + "'><span id='newsFooterText'>" + "" + "</span><span id='fn-previousButton'></span><span id='fn-nextButton'></span><div id='fn-newsViewClose'></div></div>"); h.next("#fn-newsFooterBar").hide(); h.next("#fn-newsFooterBar").find("#fn-newsViewClose").hide().click(function () { f(); h.next("#fn-newsFooterBar").find("#newsFooterText").text(""); h.find("#fn-newsView").stop().fadeTo(340, 0, function () { e(this).css("visibility", "hidden") }) }); for (n = 0; n < c.previewsPerPage; ++n) e(E[n]).hide().delay(340 + n * 340).fadeIn(800); setTimeout(function () { h.next("#fn-newsFooterBar").fadeIn(800, s) }, 340 + c.previewsPerPage * 340) } function s() { T = false; h.find(".fn-newsPreview").hover(function () { if (!T) { T = true; e(this).stop().animate({ backgroundColor: c.backgroundOverColor }, 800) } }, function () { if (!N) { T = false; e(this).stop().animate({ backgroundColor: c.backgroundColor }, 340) } }).click(function () { if (!N) { var t = h.find(".fn-newsPreview").index(this); if (c.useLinks && c.feed) window.open(w[t], c.targetWindow); else { var n = b[t] + "</br><a href='" + S[t] + "'><span style='font-size: 12px;color: #97B250;cursor: pointer;'> See full page.</span></a>"; f(); h.find("#fn-newsView").css({ visibility: "visible", opacity: 0 }).stop().fadeTo(340, 1); h.find("#fn-newsViewTitle").text(m[t]); h.next("#fn-newsFooterBar").find("#newsFooterText").text(g[t]); d.getContentPane().html(n); d.reinitialise({ verticalGutter: 15 }); d.scrollToPercentY(0); e("#fn-newsView img").jScale({ ls: c.longestImageSide }) } } }); h.next("#fn-newsFooterBar").find("#fn-previousButton").click(function () { x != 0 && !T && u() }); h.next("#fn-newsFooterBar").find("#fn-nextButton").click(function () { x != E.length - c.previewsPerPage && !T && o() }); if (c.slideTime) v = setInterval(l, c.slideTime) } function o() { a("-"); ++x; h.next("#fn-newsFooterBar").find("#newsFooterText").text(""); e(E[x + c.previewsPerPage - 1]).css("opacity", 0).animate({ opacity: 1 }, 340, function () { T = N = false }) } function u() { --x; a("+"); h.next("#fn-newsFooterBar").find("#newsFooterText").text(""); e(E[x]).css("opacity", 0).animate({ opacity: 1 }, function () { T = N = false }) } function a(t) { N = T = true; for (var n = p + 2, r = x; r < E.length; ++r) e(E[r]).animate({ top: t + "=" + n + "px" }, 340) } function f() { if (h.next().find("#fn-previousButton").is(":hidden")) { h.next().find("#fn-newsViewClose").hide(); h.next().find("#fn-previousButton, #fn-nextButton").show(); if (c.slideTime) v = setInterval(l, c.slideTime) } else { h.next().find("#fn-newsViewClose").show(); h.next().find("#fn-previousButton, #fn-nextButton").hide(); c.slideTime && clearInterval(v) } } function l() { if (!T) { if (x != 0 && !T && C == "previous") u(); else C = "next"; if (x != E.length - c.previewsPerPage && !T && C == "next") o(); else C = "previous" } } var c = e.extend({}, e.fn.fancyNews.defaults, n), h, p, d, v, m = [], g = [], y = [], b = [], w = [], E = [], S = [], x = 0, T = true, N = false, C = "next"; return this.each(function () { h = e(this); var n = e.makeArray(h.find("div").hide()); h.css({ overflow: "hidden", position: "relative", width: c.width, height: c.height + c.previewOffset * c.previewsPerPage }); h.append("<div id='fn-preloader'></div>"); h.find("#fn-preloader").css({ top: c.height * .5 - h.find("#fn-preloader").height() * .5, left: c.width * .5 - h.find("#fn-preloader").width() * .5 }); p = c.height / c.previewsPerPage; if (c.feed) r(); else { for (var s = [], o = 0; o < n.length; ++o) { g[o] = e(n[o]).attr("title") ? e(n[o]).attr("title") : ""; m[o] = e(n[o]).children("span").attr("title").length > 0 ? e(n[o]).find("span").attr("title") : ""; S[o] = e(n[o]).attr("link") ? e(n[o]).attr("link") : ""; y[o] = t(e(n[o]).children("span").text(), c.maxWords); b[o] = e(n[o]).children("span").html(); var u = e(n[o]).children("img").attr("src"); s[o] = "<div class='fn-newsPreview' style='width:" + c.width + "px; height:" + p + "px; background:" + c.backgroundColor + ";'>" + (u ? '<img class="fn-newsPreviewThumb" src="' + u + '" />' : "") + "<span class='fn-newsPreviewText' ><h3>" + m[o] + "</h3><h4>" + g[o] + "</h4>" + y[o] + "</span></div>" } i(s) } }) }; e.fn.fancyNews.defaults = { width: 340, height: 200, previewOffset: 2, maxWords: 60, previewsPerPage: 1, numOfEntries: 10, slideTime: 0, longestImageSide: 100, feed: "", backgroundColor: "#005984", backgroundOverColor: "#0077B1", useLinks: false, targetWindow: "_blank"} })(jQuery)